<div class="recept-szerk-keret">
    <div class="resze-fej">
        @if (szerkesztesiAdatok()?.kepkezelesAktiv()) {
        <p-button icon="pi pi-chevron-left"
                  severity="help"
                  [text]="true"
                  [raised]="true"
                  [label]="'Vissza'"
                  (onClick)="kepKezelesVege()"></p-button>
        } @else {
        @if (szerkesztesiAdatok()?.recept()?.azon) {
        <div class="kedvenc-allito">
            <p-button [icon]="szerkesztesiAdatok()?.recept()?.kedvencE ? 'pi pi-star-fill' : 'pi pi-star'"
                      severity="warning"
                      [rounded]="true"
                      [text]="true"
                      [raised]="true"
                      (onClick)="kedvencsegAllitas()"></p-button>
        </div>
        <p-button icon="pi pi-image"
                  severity="help"
                  [text]="true"
                  [raised]="true"
                  [label]="'Képek'"
                  (onClick)="kepKezelesInditas()"></p-button>
        @if (szerkesztesiAdatok()?.recept()?.sajatE || sajatMegjegyzesVanE()) {
        <p-button icon="pi pi-save"
                  severity="primary"
                  [text]="true"
                  [raised]="true"
                  label="Mentés"
                  (onClick)="mentes()"
                  [disabled]="!receptMentheto()"></p-button>
        }
        }
        @if (!mobilE()) {
        <p-button icon="pi pi-plus"
                  severity="success"
                  [text]="true"
                  [raised]="true"
                  label="Új recept"
                  (onClick)="ujReceptFelvetelInditas()"></p-button>
        }
        }
    </div>
    @if (this.szerkesztesiAdatok()?.kepkezelesAktiv()) {
    <div class="resze-torzs keptorzs">
        @if (this.szerkesztesiAdatok()?.kepekInfo()?.items?.length > 0) {}
        @for (kepInfo of this.szerkesztesiAdatok()?.kepekInfo()?.items; track kepInfo.name) {
        <app-recept-kep-kezelo [kepInfo]="kepInfo"
                               [sajatE]="szerkesztesiAdatok()?.recept()?.sajatE"></app-recept-kep-kezelo>
        }
    </div>
    } @else {
    <div class="resze-torzs">
        @if (!szerkesztesiAdatok()?.recept()?.sajatE) {
        <div class="torzs-sor nem-sajat">
            Nem saját recept esetén csak a saját megjegyzés módosítható.
        </div>
        }
        @if (torzsMegjelenithetoE()) {
        <div class="torzs-sor nev">
            <div class="mezo-felirat">Név:</div>
            <div class="mezo-torzs">
                <input type="text"
                       pInputText
                       class="mezo-input"
                       [ngClass]="{'ng-invalid ng-dirty': szerkesztesiAdatok()?.recept()?.nev?.length < 1}"
                       [disabled]="!szerkesztesiAdatok()?.recept()?.sajatE"
                       [ngModel]="szerkesztesiAdatok()?.recept().nev"
                       (ngModelChange)="nevModositas($event)" />
            </div>
        </div>
        <div class="torzs-sor keszites">
            <div class="mezo-felirat">Készítés:</div>
            <div class="mezo-torzs">
                <input type="text"
                       pInputText
                       class="mezo-input"
                       [disabled]="!szerkesztesiAdatok()?.recept()?.sajatE"
                       [ngModel]="szerkesztesiAdatok()?.recept().keszites"
                       (ngModelChange)="keszitesModositas($event)" />
            </div>
        </div>
        <div class="torzs-sor leiras">
            <div class="mezo-felirat">Leírás:</div>
            <div class="mezo-torzs">
                <textarea rows="2"
                          class="mezo-input"
                          pInputTextarea
                          [disabled]="!szerkesztesiAdatok()?.recept()?.sajatE"
                          [autoResize]="true"
                          [ngClass]="{'ng-invalid ng-dirty': szerkesztesiAdatok()?.recept()?.leiras?.length < 1}"
                          [ngModel]="szerkesztesiAdatok()?.recept().leiras"
                          (ngModelChange)="leirasModositas($event)">
                </textarea>
            </div>
        </div>
        <div class="torzs-sor megjegyzesek">
            <div class="mezo-felirat">Megjegyzések:</div>
            <div class="mezo-torzs megj-torzs">
                @if (szerkesztesiAdatok()?.recept()?.megjegyzesek?.length > 0) {
                @for (megjegyzes of szerkesztesiAdatok()?.recept()?.megjegyzesek; track megjegyzes) {
                <div class="megj-blokk">
                    <div class="mb-bal">
                        <div class="mb-bal-felh">
                            {{ megjegyzes.felhasznaloAzon }}
                        </div>
                        <div class="mb-bal-ido">
                            {{ megjegyzes.idopont }}
                        </div>
                    </div>
                    <div class="mb-jobb">
                        <textarea rows="2"
                                  class="mb-input"
                                  pInputTextarea
                                  [disabled]="!megjegyzes.sajatE"
                                  [autoResize]="true"
                                  [ngClass]="{ 'ng-invalid ng-dirty': megjegyzes.sajatE && megjegyzes.duma?.length < 1}"
                                  [(ngModel)]="megjegyzes.duma"
                                  (ngModelChange)="megjegyzesModositas(megjegyzes)">
                        </textarea>
                    </div>
                    @if (megjegyzes.sajatE) {
                    <div class="megj-torles">
                        <p-button icon="pi pi-trash"
                                  severity="danger"
                                  [rounded]="true"
                                  [text]="true"
                                  [raised]="true"
                                  (onClick)="sajatMegjegyzesTorles($event, megjegyzes)"></p-button>
                        <p-confirmPopup #megjegyzesConfirmPopupRef
                                        key="megjegyzesConfirmPopupRef">
                            <ng-template pTemplate="headless"
                                         let-message>
                                <div class="egyszeru-confirm-keret">
                                    <div class="eck-uzi">
                                        <span>{{ message.message }}</span>
                                    </div>
                                    <div class="eck-gombok">
                                        <p-button icon="pi pi-trash"
                                                  severity="danger"
                                                  [rounded]="true"
                                                  [text]="true"
                                                  (onClick)="megjTorlesAccept()"></p-button>
                                        <p-button icon="pi pi pi-undo"
                                                  [rounded]="true"
                                                  [text]="true"
                                                  (onClick)="megjTorlesReject()"></p-button>
                                    </div>
                                </div>
                            </ng-template>
                        </p-confirmPopup>
                    </div>
                    }
                </div>
                }
                } @else {
                <div class="nincs-megj">
                    <em>Nincs megjegyzés rögzítve</em>
                </div>
                } @if (!sajatMegjegyzesVanE()) {
                <div class="uj-megjegyzes">
                    <div class="uj-megj-gomb">
                        <p-button icon="pi pi-plus"
                                  severity="help"
                                  [text]="true"
                                  [raised]="true"
                                  label="Új megjegyzés"
                                  (onClick)="ujMegjegyzesRogzitesInditas()"></p-button>
                    </div>
                </div>
                }
            </div>
        </div>
        <div class="torzs-sor linkek">
            <div class="mezo-felirat">Linkek:</div>
            <div class="mezo-torzs link-torzs"
                 [ngClass]="{ 'idegen': !szerkesztesiAdatok()?.recept()?.sajatE}">
                @if (szerkesztesiAdatok()?.recept()?.linkek?.length > 0) {
                @for (link of szerkesztesiAdatok()?.recept()?.linkek; track link) {
                <app-recept-linker [link]="link"
                                   [sajatE]="szerkesztesiAdatok()?.recept()?.sajatE"
                                   [ujLinkFelvetelE]="false"
                                   (linkModositva)="linkModositva($event, $index)"
                                   (linkTorlesOK)="linkTorlesOK($event, $index)"></app-recept-linker>
                }
                } @else {
                <div class="nincs-link">
                    <em>Nincs Link rögzítve</em>
                </div>
                }
                @if (szerkesztesiAdatok()?.recept()?.sajatE) {
                <!-- <div class="uj-link">
                    <div class="uj-link-gomb">
                        <p-button icon="pi pi-plus"
                                  severity="help"
                                  [text]="true"
                                  [raised]="true"
                                  label="Új link"
                                  (onClick)="ujLinkRogzitesInditas()"></p-button>
                    </div>
                </div> -->
                <app-recept-linker [link]="null"
                                   [sajatE]="true"
                                   [ujLinkFelvetelE]="true"
                                   (linkModositva)="linkFelveve($event)"></app-recept-linker>
                }
            </div>
        </div>
        <!-- <div class="torzs-sor kepek">
            <div class="mezo-felirat">Képek:</div>
            <div class="mezo-torzs">
                @if(szerkesztesiAdatok()?.forrasRecept?.azon) {
                <p-button icon="pi pi-image"
                          severity="help"
                          [text]="true"
                          [raised]="true"
                          [label]="szerkesztesiAdatok()?.recept()?.kepek?.length + ' db'"
                          (onClick)="kepKezelesInditas()"></p-button>
                } @else {
                <span class="kep-readonly">A recept elmentéséig a képek kezelése nem elérhető</span>
                }
            </div>
        </div> -->
        }
    </div>
    }
</div>